@layout MainLayout
@using PizzaPlace.Shared

@page "/"

<!--    Start Menu -->
@foreach (Pizza pizza in State.Menu.Pizzas)
{
    <div class="row">
        <div class="col">@pizza.Name</div>
        <div class="col">@pizza.Price</div>
        <div class="col">
            <img style="width: 40%;" src="@SpicinessImage(pizza.Spiciness)"
            alt="@pizza.Spiciness"/>
        </div>
        <div class="col">
            <button class="btn btn-success" 
            @onclick="@(()=>AddToBasket(pizza))">
            Add
            </button>
        </div>
    </div>
}
<!--    End Menu-->
<!-- Display Shopping Cart-->
@if(State.Basket.Orders.Any())
{
    <h1>Your current shopping orders</h1>
    @foreach (var (pizza,pos) in State.Basket.Orders.Select(
        (id,pos)=>(State.Menu.GetPizza(id),pos)))
    {
        <div class="row">
            <div class="col">@pizza.Name</div>
            <div class="col">@pizza.Price</div>
            <div class="col">
                <button class="btn btn-danger"
                @onclick="@(()=>RemoveFromBasket(pos))"
                >
                    Remove
                </button>
            </div>
        </div>
    }
    <div class="row">
        <div class="col">Total:</div>
        <div class="col">@State.TotalPrice</div>
        <div class="col"></div>
    </div>
}
<!-- End Shopping Cart-->
<!-- Customer Entry-->
<h1>Customer Details</h1>
<EditForm OnValidSubmit="PlaceOrder"
Model="State.Basket.Customer">
<DataAnnotationsValidator/>
<ValidationSummary/>
<div class="form-group row mb-1">
<label class="col-sm-3 col-form-label" 
for="name" >Name:
</label>
<div class="col-sm-9">
    <InputText class="form-control"
    @bind-Value="@State.Basket.Customer.Name">
    </InputText>
    <ValidationMessage 
    For="@(()=> State.Basket.Customer.Name)"/>
</div>
</div>
 <div class="form-group row mb-1">
    <label class="col-sm-3 col-form-label"
           for="street">Street:</label>
    <div class="col-sm-9">
      <InputText class="form-control"
        @bind-Value="@State.Basket.Customer.Street" />
      <ValidationMessage
        For="@(() => State.Basket.Customer.Street)" />
    </div>
  </div>
  <div class="form-group row mb-1">
    <label class="col-sm-3 col-form-label"
           for="city">City:</label>
    <div class="col-sm-9">
      <InputText class="form-control"
        @bind-Value="@State.Basket.Customer.City" />
      <ValidationMessage
        For="@(() => State.Basket.Customer.City)" />
    </div>
    </div>
  <div class="form-group mb-0">
    <button type="submit"
            id="checkout" class="btn btn-warning">
      Checkout
    </button>
  </div>
</EditForm>
<!-- End Customer Entry-->
@code {
    private State State { get; } = new State()
        {
    Menu = new Menu
        {
            Pizzas = new List<Pizza>
            {
                new Pizza(1,"Pepperoni",8.99M,Spiciness.Spicy),
                new Pizza(2,"Margarita",7.99M,Spiciness.None),
                new Pizza(3,"Diabolo",9.99M,Spiciness.Hot)
            }
        }
        };
        private string SpicinessImage(Spiciness spiciness)=>
        $"images/{spiciness.ToString().ToLower()}.png";
        private void AddToBasket(Pizza pizza)
        {
            Console.WriteLine($"Added Pizza successfully{pizza.Name}");
            State.Basket.Add(pizza.Id);
        }
        private void RemoveFromBasket(int pos)
        {
            Console.WriteLine($"Pizza is removed from the cart {pos}");
            State.Basket.RemoveAt(pos);
        }
        private void PlaceOrder()
        {
             Console.WriteLine("Placing order");
        }
}